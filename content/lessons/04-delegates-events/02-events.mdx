---
title: "Events"
description: "Learn how to implement the observer pattern with C# events"
order: 2
difficulty: "advanced"
tags: ["events", "observer pattern", "EventHandler"]
duration: "30 minutes"
---

# Events in C#

Events provide a way for a class to notify other classes when something interesting happens. They implement the observer pattern and are built on top of delegates.

## What is an Event?

An event is a special type of delegate that:
- Can only be invoked from within the class that declares it
- External classes can only subscribe (+= ) or unsubscribe (-=)
- Provides loose coupling between publishers and subscribers

## Basic Event Syntax

<CodeEditor 
  initialCode={`using System;

class Button
{
    // Declare an event using EventHandler delegate
    public event EventHandler Clicked;
    
    public string Text { get; set; }
    
    public Button(string text)
    {
        Text = text;
    }
    
    // Method to raise the event
    public void Click()
    {
        Console.WriteLine($"Button '{Text}' was clicked");
        
        // Raise the event (null check is important!)
        Clicked?.Invoke(this, EventArgs.Empty);
    }
}

class Program
{
    static void Main()
    {
        Button button = new Button("Submit");
        
        // Subscribe to the event
        button.Clicked += OnButtonClicked;
        button.Clicked += OnButtonClickedAgain;
        
        // Simulate clicks
        button.Click();
        
        Console.WriteLine("\\n--- Unsubscribing one handler ---");
        button.Clicked -= OnButtonClickedAgain;
        
        button.Click();
    }
    
    static void OnButtonClicked(object sender, EventArgs e)
    {
        Button btn = (Button)sender;
        Console.WriteLine($"  Handler 1: '{btn.Text}' button processed");
    }
    
    static void OnButtonClickedAgain(object sender, EventArgs e)
    {
        Console.WriteLine("  Handler 2: Click logged");
    }
}`}
/>

## Custom Event Arguments

<CodeEditor 
  initialCode={`using System;

// Custom event arguments
class TemperatureChangedEventArgs : EventArgs
{
    public double OldTemperature { get; }
    public double NewTemperature { get; }
    public DateTime ChangeTime { get; }
    
    public TemperatureChangedEventArgs(double oldTemp, double newTemp)
    {
        OldTemperature = oldTemp;
        NewTemperature = newTemp;
        ChangeTime = DateTime.Now;
    }
    
    public double Difference => NewTemperature - OldTemperature;
}

class Thermostat
{
    private double temperature;
    
    // Event with custom args
    public event EventHandler<TemperatureChangedEventArgs> TemperatureChanged;
    
    public double Temperature
    {
        get => temperature;
        set
        {
            if (value != temperature)
            {
                var args = new TemperatureChangedEventArgs(temperature, value);
                temperature = value;
                OnTemperatureChanged(args);
            }
        }
    }
    
    protected virtual void OnTemperatureChanged(TemperatureChangedEventArgs e)
    {
        TemperatureChanged?.Invoke(this, e);
    }
}

class Program
{
    static void Main()
    {
        Thermostat thermostat = new Thermostat();
        
        // Subscribe with lambda
        thermostat.TemperatureChanged += (sender, e) =>
        {
            Console.WriteLine($"Temperature changed from {e.OldTemperature}°C to {e.NewTemperature}°C");
            Console.WriteLine($"  Change: {e.Difference:+0.0;-0.0}°C at {e.ChangeTime:HH:mm:ss}");
        };
        
        // Subscribe with method
        thermostat.TemperatureChanged += CheckForAlarm;
        
        // Change temperature
        thermostat.Temperature = 20;
        thermostat.Temperature = 25;
        thermostat.Temperature = 35;  // Triggers alarm
        thermostat.Temperature = 15;
    }
    
    static void CheckForAlarm(object sender, TemperatureChangedEventArgs e)
    {
        if (e.NewTemperature > 30)
        {
            Console.WriteLine("  *** ALARM: Temperature too high! ***");
        }
        else if (e.NewTemperature < 18)
        {
            Console.WriteLine("  *** ALARM: Temperature too low! ***");
        }
    }
}`}
/>

## Standard Event Pattern

<CodeEditor 
  initialCode={`using System;

// Standard event argument class
class OrderEventArgs : EventArgs
{
    public int OrderId { get; }
    public string CustomerName { get; }
    public decimal Total { get; }
    
    public OrderEventArgs(int id, string customer, decimal total)
    {
        OrderId = id;
        CustomerName = customer;
        Total = total;
    }
}

class OrderProcessor
{
    // Standard events following .NET conventions
    public event EventHandler<OrderEventArgs> OrderReceived;
    public event EventHandler<OrderEventArgs> OrderProcessing;
    public event EventHandler<OrderEventArgs> OrderCompleted;
    public event EventHandler<OrderEventArgs> OrderFailed;
    
    // Protected virtual method pattern for raising events
    protected virtual void OnOrderReceived(OrderEventArgs e)
    {
        OrderReceived?.Invoke(this, e);
    }
    
    protected virtual void OnOrderProcessing(OrderEventArgs e)
    {
        OrderProcessing?.Invoke(this, e);
    }
    
    protected virtual void OnOrderCompleted(OrderEventArgs e)
    {
        OrderCompleted?.Invoke(this, e);
    }
    
    protected virtual void OnOrderFailed(OrderEventArgs e)
    {
        OrderFailed?.Invoke(this, e);
    }
    
    public void ProcessOrder(int orderId, string customer, decimal total)
    {
        var args = new OrderEventArgs(orderId, customer, total);
        
        OnOrderReceived(args);
        OnOrderProcessing(args);
        
        // Simulate processing (90% success)
        if (new Random().Next(10) > 0)
        {
            OnOrderCompleted(args);
        }
        else
        {
            OnOrderFailed(args);
        }
    }
}

class Program
{
    static void Main()
    {
        OrderProcessor processor = new OrderProcessor();
        
        // Subscribe to events
        processor.OrderReceived += (s, e) => 
            Console.WriteLine($"[Received] Order #{e.OrderId} from {e.CustomerName}");
        
        processor.OrderProcessing += (s, e) =>
            Console.WriteLine($"[Processing] Order #{e.OrderId} - \\${'{'}e.Total{'}'}");
        
        processor.OrderCompleted += (s, e) => 
            Console.WriteLine($"[Completed] Order #{e.OrderId} ✓");
        
        processor.OrderFailed += (s, e) => 
            Console.WriteLine($"[Failed] Order #{e.OrderId} ✗");
        
        // Process some orders
        for (int i = 1; i <= 3; i++)
        {
            Console.WriteLine($"\\n--- Processing Order {i} ---");
            processor.ProcessOrder(i, $"Customer {i}", 99.99m * i);
        }
    }
}`}
/>

## Event Accessors

Custom add/remove logic for events:

<CodeEditor 
  initialCode={`using System;
using System.Collections.Generic;

class SecureEventPublisher
{
    private List<EventHandler> handlers = new List<EventHandler>();
    private const int MaxSubscribers = 3;
    
    // Custom event accessors
    public event EventHandler DataReceived
    {
        add
        {
            if (handlers.Count >= MaxSubscribers)
            {
                Console.WriteLine($"Cannot add handler: max {MaxSubscribers} subscribers reached");
                return;
            }
            handlers.Add(value);
            Console.WriteLine($"Handler added. Total: {handlers.Count}");
        }
        remove
        {
            handlers.Remove(value);
            Console.WriteLine($"Handler removed. Total: {handlers.Count}");
        }
    }
    
    public void SimulateDataReceived()
    {
        Console.WriteLine("\\nData received! Notifying subscribers...");
        foreach (var handler in handlers)
        {
            handler?.Invoke(this, EventArgs.Empty);
        }
    }
}

class Program
{
    static void Main()
    {
        SecureEventPublisher publisher = new SecureEventPublisher();
        
        EventHandler handler1 = (s, e) => Console.WriteLine("  Handler 1 executed");
        EventHandler handler2 = (s, e) => Console.WriteLine("  Handler 2 executed");
        EventHandler handler3 = (s, e) => Console.WriteLine("  Handler 3 executed");
        EventHandler handler4 = (s, e) => Console.WriteLine("  Handler 4 executed");
        
        // Subscribe
        publisher.DataReceived += handler1;
        publisher.DataReceived += handler2;
        publisher.DataReceived += handler3;
        publisher.DataReceived += handler4;  // Should fail
        
        publisher.SimulateDataReceived();
        
        // Unsubscribe one
        publisher.DataReceived -= handler2;
        
        // Now we can add handler4
        publisher.DataReceived += handler4;
        
        publisher.SimulateDataReceived();
    }
}`}
/>

## Observer Pattern Implementation

<CodeEditor 
  initialCode={`using System;
using System.Collections.Generic;

// Subject (Publisher)
class StockMarket
{
    private Dictionary<string, decimal> stocks = new Dictionary<string, decimal>();
    
    public event EventHandler<StockChangedEventArgs> StockPriceChanged;
    
    public void UpdateStock(string symbol, decimal newPrice)
    {
        decimal oldPrice = stocks.ContainsKey(symbol) ? stocks[symbol] : 0;
        stocks[symbol] = newPrice;
        
        StockPriceChanged?.Invoke(this, new StockChangedEventArgs(symbol, oldPrice, newPrice));
    }
}

class StockChangedEventArgs : EventArgs
{
    public string Symbol { get; }
    public decimal OldPrice { get; }
    public decimal NewPrice { get; }
    public decimal Change => NewPrice - OldPrice;
    public decimal ChangePercent => OldPrice > 0 ? (Change / OldPrice) * 100 : 0;
    
    public StockChangedEventArgs(string symbol, decimal oldPrice, decimal newPrice)
    {
        Symbol = symbol;
        OldPrice = oldPrice;
        NewPrice = newPrice;
    }
}

// Observer 1: Price Display
class PriceDisplay
{
    public void OnStockChanged(object sender, StockChangedEventArgs e)
    {
        string direction = e.Change >= 0 ? "↑" : "↓";
        Console.WriteLine($"[Display] {e.Symbol}: \\${'{'}e.NewPrice:F2{'}'} {direction} ({e.ChangePercent:+0.00;-0.00}%)");
    }
}

// Observer 2: Alert System
class AlertSystem
{
    private decimal threshold;
    
    public AlertSystem(decimal alertThreshold)
    {
        threshold = alertThreshold;
    }
    
    public void OnStockChanged(object sender, StockChangedEventArgs e)
    {
        if (Math.Abs(e.ChangePercent) > threshold)
        {
            Console.WriteLine($"[ALERT] {e.Symbol} moved {e.ChangePercent:0.00}% - exceeds {threshold}% threshold!");
        }
    }
}

// Observer 3: Trade Bot
class TradeBot
{
    public void OnStockChanged(object sender, StockChangedEventArgs e)
    {
        if (e.ChangePercent < -5)
        {
            Console.WriteLine($"[Bot] Buying {e.Symbol} - price dropped significantly");
        }
        else if (e.ChangePercent > 5)
        {
            Console.WriteLine($"[Bot] Selling {e.Symbol} - taking profits");
        }
    }
}

class Program
{
    static void Main()
    {
        StockMarket market = new StockMarket();
        
        // Create observers
        PriceDisplay display = new PriceDisplay();
        AlertSystem alerts = new AlertSystem(3);
        TradeBot bot = new TradeBot();
        
        // Subscribe
        market.StockPriceChanged += display.OnStockChanged;
        market.StockPriceChanged += alerts.OnStockChanged;
        market.StockPriceChanged += bot.OnStockChanged;
        
        // Simulate market updates
        Console.WriteLine("=== Market Open ===\\n");
        market.UpdateStock("AAPL", 150.00m);
        market.UpdateStock("GOOGL", 2800.00m);
        market.UpdateStock("MSFT", 300.00m);
        
        Console.WriteLine("\\n=== Price Updates ===\\n");
        market.UpdateStock("AAPL", 155.00m);  // +3.33%
        market.UpdateStock("GOOGL", 2700.00m);  // -3.57%
        market.UpdateStock("MSFT", 280.00m);  // -6.67%
    }
}`}
/>

## UI Event Handling Example

<CodeEditor 
  initialCode={`using System;

// UI Components with events
class TextBox
{
    private string text = "";
    
    public event EventHandler<TextChangedEventArgs> TextChanged;
    
    public string Text
    {
        get => text;
        set
        {
            if (text != value)
            {
                string oldText = text;
                text = value;
                TextChanged?.Invoke(this, new TextChangedEventArgs(oldText, value));
            }
        }
    }
}

class TextChangedEventArgs : EventArgs
{
    public string OldText { get; }
    public string NewText { get; }
    
    public TextChangedEventArgs(string oldText, string newText)
    {
        OldText = oldText;
        NewText = newText;
    }
}

class Form
{
    public TextBox UsernameBox { get; } = new TextBox();
    public TextBox PasswordBox { get; } = new TextBox();
    
    private bool isValid = false;
    
    public Form()
    {
        // Wire up event handlers
        UsernameBox.TextChanged += OnFieldChanged;
        PasswordBox.TextChanged += OnFieldChanged;
    }
    
    private void OnFieldChanged(object sender, TextChangedEventArgs e)
    {
        Console.WriteLine($"Field changed: '{e.OldText}' -> '{e.NewText}'");
        ValidateForm();
    }
    
    private void ValidateForm()
    {
        bool wasValid = isValid;
        isValid = UsernameBox.Text.Length >= 3 && PasswordBox.Text.Length >= 6;
        
        if (isValid != wasValid)
        {
            Console.WriteLine($"Form validity changed: {isValid}");
        }
    }
    
    public void Submit()
    {
        if (isValid)
        {
            Console.WriteLine($"\\nSubmitting form...");
            Console.WriteLine($"Username: {UsernameBox.Text}");
            Console.WriteLine($"Password: {"*".PadLeft(PasswordBox.Text.Length, '*')}");
        }
        else
        {
            Console.WriteLine("\\nCannot submit - form is invalid!");
        }
    }
}

class Program
{
    static void Main()
    {
        Form loginForm = new Form();
        
        Console.WriteLine("=== Filling Form ===\\n");
        
        loginForm.UsernameBox.Text = "jo";  // Too short
        loginForm.Submit();
        
        loginForm.UsernameBox.Text = "john";  // Valid length
        loginForm.PasswordBox.Text = "123";   // Too short
        loginForm.Submit();
        
        loginForm.PasswordBox.Text = "secretpass";  // Valid
        loginForm.Submit();
    }
}`}
/>

## Complete Example: Game Events

<CodeEditor 
  initialCode={`using System;

// Event arguments
class PlayerEventArgs : EventArgs
{
    public string PlayerName { get; }
    public int Value { get; }
    
    public PlayerEventArgs(string name, int value = 0)
    {
        PlayerName = name;
        Value = value;
    }
}

// Game with events
class Game
{
    public event EventHandler GameStarted;
    public event EventHandler GameEnded;
    public event EventHandler<PlayerEventArgs> PlayerScored;
    public event EventHandler<PlayerEventArgs> PlayerDied;
    public event EventHandler<PlayerEventArgs> LevelCompleted;
    
    private string currentPlayer;
    private int score;
    private int level = 1;
    private int lives = 3;
    
    public void Start(string playerName)
    {
        currentPlayer = playerName;
        score = 0;
        level = 1;
        lives = 3;
        
        Console.WriteLine($"\\n{'=',-40}");
        GameStarted?.Invoke(this, EventArgs.Empty);
    }
    
    public void AddScore(int points)
    {
        score += points;
        PlayerScored?.Invoke(this, new PlayerEventArgs(currentPlayer, points));
        
        if (score >= level * 100)
        {
            level++;
            LevelCompleted?.Invoke(this, new PlayerEventArgs(currentPlayer, level));
        }
    }
    
    public void TakeDamage()
    {
        lives--;
        if (lives <= 0)
        {
            PlayerDied?.Invoke(this, new PlayerEventArgs(currentPlayer, score));
            End();
        }
    }
    
    public void End()
    {
        GameEnded?.Invoke(this, EventArgs.Empty);
    }
}

// UI that responds to events
class GameUI
{
    public void Subscribe(Game game)
    {
        game.GameStarted += (s, e) => Console.WriteLine("[UI] Game Started! Good luck!");
        game.GameEnded += (s, e) => Console.WriteLine("[UI] Game Over!");
        game.PlayerScored += (s, e) => Console.WriteLine($"[UI] {e.PlayerName} scored {e.Value} points!");
        game.PlayerDied += (s, e) => Console.WriteLine($"[UI] {e.PlayerName} died with {e.Value} points");
        game.LevelCompleted += (s, e) => Console.WriteLine($"[UI] *** LEVEL {e.Value} ***");
    }
}

// Sound system that responds to events
class SoundSystem
{
    public void Subscribe(Game game)
    {
        game.GameStarted += (s, e) => Console.WriteLine("[Sound] ♪ Playing intro music");
        game.PlayerScored += (s, e) => Console.WriteLine("[Sound] ♪ Ding!");
        game.PlayerDied += (s, e) => Console.WriteLine("[Sound] ♪ Sad trombone");
        game.LevelCompleted += (s, e) => Console.WriteLine("[Sound] ♪ Level up fanfare!");
    }
}

// Analytics that tracks events
class Analytics
{
    private int totalScore = 0;
    private int deaths = 0;
    
    public void Subscribe(Game game)
    {
        game.PlayerScored += (s, e) => totalScore += e.Value;
        game.PlayerDied += (s, e) => deaths++;
        game.GameEnded += (s, e) => 
        {
            Console.WriteLine($"[Analytics] Session stats: Score={totalScore}, Deaths={deaths}");
        };
    }
}

class Program
{
    static void Main()
    {
        Game game = new Game();
        
        // Subscribe systems
        GameUI ui = new GameUI();
        SoundSystem sound = new SoundSystem();
        Analytics analytics = new Analytics();
        
        ui.Subscribe(game);
        sound.Subscribe(game);
        analytics.Subscribe(game);
        
        // Play the game
        game.Start("Player1");
        
        game.AddScore(50);
        game.AddScore(60);  // Level up!
        game.AddScore(30);
        
        game.TakeDamage();
        game.TakeDamage();
        game.TakeDamage();  // Dies
    }
}`}
/>

## Key Takeaways

- **Events** are special delegates that can only be raised from within the class
- Use **EventHandler** or **EventHandler&lt;T&gt;** for standard events
- Create **custom EventArgs** to pass data with events
- Events implement the **observer pattern**
- Subscribers can **add (+= )** and **remove (-=)** handlers
- Always check for **null** before invoking events

## Best Practices

1. **Follow naming conventions**: Event names should be verbs (Clicked, Changed)
2. **Use EventArgs pattern**: Create custom EventArgs for event data
3. **Provide OnEventName methods**: Protected virtual methods for raising events
4. **Check for null**: Use `?.Invoke()` or null check before raising
5. **Unsubscribe when done**: Prevent memory leaks by removing handlers

## Next Steps

Next lesson: **Lambda Expressions** - Write inline functions for cleaner code!
